version: "3.7"
volumes:
    postgres-data:
services:
    proxy:
        image: nginx:latest
        ports:
            - 80:80
            - 443:443
        volumes:
            - ./:/var/www/app
            - ./docker/nginx/nginx-site-${SERVER_PROTOCOL:-http}.conf:/etc/nginx/conf.d/default.conf
            - ./docker/certs/:/etc/certs
        depends_on:
            - php

    php:
        build:
            context: ./docker/php
            dockerfile: Dockerfile
        image: laravelgis-php:latest
        ports:
            - 5173:5173
        volumes:
            - ./:/var/www/app
            - ./docker/php/php.ini:/usr/local/etc/php/php.ini
        depends_on:
            - postgres

    postgres:
        image: postgis/postgis:15-3.3
        volumes:
            - postgres-data:/var/lib/postgresql/data
        ports:
            - 5432:5432
        environment:
            PGDATA: /var/lib/postgresql/data
            POSTGRES_DB: ${DB_DATABASE:-registrackerdb}
            POSTGRES_USER: ${DB_USERNAME:-registracker}
            POSTGRES_PASSWORD: ${DB_PASSWORD:-registracker#1234}

    nodejs:
        image: node:16-alpine
        working_dir: /app
        volumes:
            - ./web/:/app

    # pgadmin:
    #     image: dpage/pgadmin4:latest
    #     restart: always
    #     environment:
    #         - PGADMIN_DEFAULT_EMAIL=postgis@gmail.com
    #         - PGADMIN_DEFAULT_PASSWORD=postgis
    #     ports:
    #         - 8086:80
    #     volumes:
    #         - ./docker/pgadmin/servers.json:/pgadmin4/servers.json
    #     depends_on:
    #         - postgres
            # networks:
            #     - backend

            # redis:
            #     image: redis:7
            #     sysctls:
            #         - net.core.somaxconn=511
            #     ports:
            #         - "6379:6379"
            #     volumes:
            #         - redis-data:/data
            #     networks:
            #         - backend

            # geoserver:
            #     image: kartoza/geoserver:2.22.0
            #     ports:
            #         - 8081:8080
            #     volumes:
            #         - ./docker-data/geoserver:/opt/geoserver/data_dir
            #     environment:
            #         - GEOSERVER_DATA_DIR=/opt/geoserver/data_dir
            #         - GEOSERVER_ADMIN_USER=admin
            #         - GEOSERVER_ADMIN_PASSWORD=geoserver
            #     depends_on:
            #         - postgres
