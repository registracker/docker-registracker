(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["web:desplazamiento:geojson"],{5494:function(e,t,a){"use strict";var n=a("83ab"),r=a("e330"),o=a("edd0"),s=URLSearchParams.prototype,i=r(s.forEach);n&&!("size"in s)&&o(s,"size",{get:function(){var e=0;return i(this,(function(){e++})),e},configurable:!0,enumerable:!0})},ac5a:function(e,t,a){"use strict";a.r(t);var n=a("8336"),r=a("b0af"),o=a("99d9"),s=a("62ad"),i=a("2e4b"),l=a("4bd4"),c=a("adda"),d=a("e449"),u=a("0fd9"),g=a("8654"),p=function(){var e=this,t=e._self._c;return t(l["a"],{ref:"formFiltro"},[t(r["a"],[t(o["d"],[t(n["a"],{staticClass:"mb-1 pb-1 pt-0 mt-0",attrs:{text:"",color:"red darken-2"},on:{click:function(t){return e.$router.go(-1)}}},[e._v(" Regresar ")]),t("br")],1),t(o["b"],[t(u["a"],{},[t(s["a"],{attrs:{cols:"12",sm:"12",md:"6"}},[t(d["a"],{ref:"menu",attrs:{"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},scopedSlots:e._u([{key:"activator",fn:function({on:a,attrs:n}){return[t(g["a"],e._g(e._b({ref:"fechas",attrs:{rules:[e.fieldRule,e.dateRangeRules],label:"Periodo",placeholder:"DD / MM / YYYY -- DD / MM / YYYY","prepend-inner-icon":"mdi-calendar-month-outline",readonly:"",outlined:"",clearable:""},on:{"click:clear":function(t){e.dateRange=[]}},model:{value:e.dateRangeText,callback:function(t){e.dateRangeText=t},expression:"dateRangeText"}},"v-text-field",n,!1),a))]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[t(i["a"],{attrs:{locale:"es",range:""},on:{change:e.save},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1)],1),t(s["a"],{attrs:{cols:"12",sm:"12",md:"2"}},[t(n["a"],{attrs:{"x-large":"",dark:"",color:"red darken-2"},on:{click:function(t){return e.buscar()}}},[e._v("Buscar")])],1)],1)],1),t(o["b"],[t(n["a"],{attrs:{outlined:"",color:"success",size:"small",disabled:!e.dateRangeText},on:{click:function(t){return e.downloadDesplazamientos()}}},[e._v(" Descargar ")]),t("br"),t("br"),e._v(" Cantidad de registros: "+e._s(e.features?e.features:"0")+" ")],1),t(o["c"],[t(c["a"],{attrs:{height:"72vh",width:"100vw"}},[t("l-map",{ref:"map",style:{position:"absolute",height:"100%",width:"100%"},attrs:{zoom:e.config.zoom,center:e.config.center},on:{ready:e.ready}},[t("l-control-layers",{attrs:{position:"topright"}}),e._l(e.tileProviders,(function(e){return t("l-tile-layer",{key:e.name,attrs:{name:e.name,visible:e.visible,url:e.url,attribution:e.attribution,"layer-type":"base"}})})),e.geojson?t("l-geo-json",{attrs:{geojson:e.geojson,options:e.geojsonOptions}}):e._e()],2)],1)],1)],1)],1)},f=[],h=(a("5494"),a("2699")),m=a("a40a"),b=a("044a"),v=a("9ee8"),y=a("132a");const R={1:"rgba(255, 99, 132)",2:"rgba(255, 159, 64)",3:"rgba(255, 205, 86)",4:"rgba(75, 192, 192)",5:"rgba(54, 162, 235)",6:"rgba(153, 102, 255)",7:"rgb(92, 70, 156)",8:"rgb(176, 71, 89)"};var w={name:"GeoJsonFiltro",components:{LMap:h["a"],LTileLayer:m["a"],LGeoJson:b["a"],LControlLayers:v["a"]},data(){return{features:null,geojson:null,dateRange:[],menu:!1,geojsonOptions:{style(e){var t,a;return{color:R[null===e||void 0===e||null===(t=e.properties)||void 0===t||null===(a=t.medios_desplazamiento)||void 0===a?void 0:a.id]||"rgb(92, 70, 156)",weight:6}},onEachFeature(e,t){var a,n;const r=null===e||void 0===e||null===(a=e.properties)||void 0===a||null===(n=a.medios_desplazamiento)||void 0===n?void 0:n.nombre;r&&t.bindPopup(r)}},tileProviders:[{name:"OpenStreetMap",visible:!0,attribution:'&copy; <a target="_blank" href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}],config:{url:"https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="https://cartodb.com/attributions">CartoDB</a>',zoom:10,center:[13.794185,-88.89652999999998]},mapa:null}},computed:{dateRangeText:{get(){if(!this.dateRange||!Array.isArray(this.dateRange))return null;if(2===this.dateRange.length){const e=this.formatDate(this.dateRange[0]),t=this.formatDate(this.dateRange[1]);return`${e} ~ ${t}`}return""},set(){return""}},dateRangeRules(){return()=>new Date(this.dateRange[1]).getTime()>=new Date(this.dateRange[0]).getTime()||this.dateRange[0]===this.dateRange[1]||"Error en las fechas"}},methods:{fieldRule:Object(y["g"])("Debe completar el campo."),ready(e){this.mapa=e,this.fetchCoordenadas()},save(e){this.$refs.menu.save(e)},async fetchCoordenadas(){try{const{data:{coleccion:t}}=await this.axios.get("recorrido/geojson/filtro",{params:{fecha_inicio:this.dateRange[0],fecha_fin:this.dateRange[1]}});var e;if(Array.isArray(t.features))this.geojson=t,this.features=(null===t||void 0===t||null===(e=t.features)||void 0===e?void 0:e.length)||0}catch(t){this.$toast.error("Error al cargar los datos."),console.log(t)}},async buscar(){this.$refs.formFiltro.validate()&&this.fetchCoordenadas()},async downloadDesplazamientos(){await this.axios({url:"/download-desplazamientos/csv",params:{fecha_inicio:this.dateRange[0],fecha_fin:this.dateRange[1]},responseType:"arraybuffer",responseEncoding:"binary",headers:{"content-type":"application/vnd.ms-excel"}}).then(e=>{const t="desplazamientos.xlsx",a=document.createElement("a");a.href=window.URL.createObjectURL(new Blob([e.data])),a.setAttribute("download",t),document.body.appendChild(a),a.click()}).catch(e=>{console.log(e)})},formatDate(e){if(!e)return null;const[t,a,n]=e.split("-");return`${n}/${a}/${t}`},parseDate(e){if(!e)return null;const[t,a,n]=e.split("/");return`${n}-${t.padStart(2,"0")}-${a.padStart(2,"0")}`}}},x=w,_=a("2877"),k=Object(_["a"])(x,p,f,!1,null,null,null);t["default"]=k.exports},edd0:function(e,t,a){var n=a("13d2"),r=a("9bf2");e.exports=function(e,t,a){return a.get&&n(a.get,t,{getter:!0}),a.set&&n(a.set,t,{setter:!0}),r.f(e,t,a)}}}]);
//# sourceMappingURL=web:desplazamiento:geojson.48d7929c.js.map